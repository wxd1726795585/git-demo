<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.mapper.Test02Mapper">


    <resultMap id="map01" type="com.example.entity.CopyEntity">
        <id property="id" column="id"/>

    </resultMap>
    <select id="selectAllStudents" resultType="com.example.entity.StudentEntity">
        select age     as age,
               id      as id,
               id_card as idCard,
               name    as name
        from student
    </select>
    <!--批量增加数据-->
    <insert id="volumeIncrease">
        insert into student (`name`,`id_card`,`id`,`age`) values
        <foreach collection="list" item="item" separator=",">
            (#{item.name},#{item.idCard},#{item.id},#{item.age})
        </foreach>
    </insert>
    <!--批量修改数据-->
    <update id="bulkChanges">
        update student
        <trim prefix="set" suffixOverrides=",">
            <trim prefix="name =case" suffix="end,">
                <foreach collection="list" item="item" index="index">
                    when id=#{item.id} then #{item.name}
                </foreach>
            </trim>
            <trim prefix="age =case" suffix="end,">
                <foreach collection="list" item="item" index="index">
                    when id=#{item.id} then #{item.age}
                </foreach>
            </trim>
        </trim>
        where id in
        <foreach collection="list" index="index" item="item" separator="," open="(" close=")">
            #{item.id}
        </foreach>
    </update>


    <!--批量修改联合主键-->
    <update id="updateMoreData">
        update trade_mq_consumer_log
        <trim prefix="set" suffixOverrides=",">
            <trim prefix="consumer_times =case" suffix="end,">
                <foreach collection="list" item="item" index="index">
                    when concat(group_name,msg_key,msg_tag)=#{item.lid} then #{item.consumerTimes}
                </foreach>
            </trim>
            <trim prefix="remark =case" suffix="end,">
                <foreach collection="list" item="item" index="index">
                    when concat(group_name,msg_key,msg_tag)=#{item.lid} then #{item.remark}
                </foreach>
            </trim>
        </trim>
        where concat(group_name,msg_key,msg_tag) in
        <foreach collection="list" index="index" item="item" separator="," open="(" close=")">
            #{item.lid}
        </foreach>
    </update>


    <select id="selectDemo" resultType="java.math.BigDecimal">
        select sum(d.test119)
        from dept d
        where d.id in
        <foreach collection="list" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>

    </select>

    <select id="testMybatis" resultType="com.example.entity.CopyEntity">
        SELECT c.age         AS age,
               c.delete_flag AS deleteFlag,
               c.gender      AS gender,
               c.id_card     AS idCard
        FROM copy c
        WHERE c.age = #{age}
          AND c.gender = #{jsonObject.gender}

    </select>


    <select id="selectCount" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM `copy` c
        WHERE c.gender = #{gender}
    </select>


    <select id="test01Sql" resultType="com.example.entity.CopyEntity">
        SELECT
        c.age AS age,
        c.delete_flag AS deleteFlag,
        c.gender AS gender,
        c.id_card AS idCard,
        c.flag as flag,
        c.name as name
        FROM copy c
        WHERE 1=1
        <if test="flag != null and flag == true">
            and c.flag=1
        </if>
        <if test="flag != null and flag == false">
            and c.flag=0
        </if>

    </select>
    <select id="test02Sql" resultType="map">
        select name as aname,
               age,
               gender,
               birthday
        from tbl_person
        where name = #{req.name}
          and gender = #{req.gender}
    </select>

    <insert id="test03Sql">
        insert into copy
            (`id`, `name`, `gender`)
        values (#{copy.id}, #{copy.name}, #{copy.gender})
    </insert>

    <update id="test04Sql">
        UPDATE `copy`
        SET `name` = '测试'
        WHERE id = #{id};
    </update>

    <select id="pessimisticLockById" resultType="com.example.entity.CopyEntity">
        select id     as id,
               name   as name,
               gender as gender,
               count as count
        from copy
        where id =#{id}
            for
        update
    </select>

    <update id="updateCount">
        update copy
        set count =count - 1
        where id = #{id}
    </update>

    <insert id="insertCopy">
        insert into copy
        values (#{id}, '张三', '18', '10')
    </insert>

    <select id="selectCopyList" resultType="com.example.entity.CopyEntity">
        SELECT c.id     id,
               c.name   name,
               c.count  `count`,
               c.gender gender
        FROM copy c
    </select>

    <update id="updateById">
        update copy
        set `name` ='李四'
        where id = #{id}
    </update>

    <select id="selectById" resultType="map">
        select *
        from copy
        where id = #{id}
    </select>

    <select id="selectCopyCounts" resultType="integer">
        SELECT count(*)
        FROM `copy`
        where id = '2'
    </select>

    <select id="getCopyEntityById" resultType="com.example.entity.CopyEntity">
        select id     as id,
               name   as name,
               gender as gender
        from `copy`
        where id = '2'
    </select>

    <select id="getCopyEntityList" resultType="com.example.entity.CopyEntity">
        select id     as id,
               name   as name,
               gender as gender
        from `copy`
        where id = '2'
    </select>

    <!--查询商户所有关联代理-->
    <select id="doFindUpperAgentIds" resultType="com.example.entity.UpperAgentRes">
        SELECT c2.cooperator_id AS agentIdOne,
               c3.cooperator_id AS agentIdTwo,
               c4.cooperator_id AS agentIdThree
        FROM tbl_cooperator_conf c1
                 LEFT JOIN tbl_cooperator_conf c2 ON c1.upper_agent_id = c2.cooperator_id
                 LEFT JOIN tbl_cooperator_conf c3 ON c2.upper_agent_id = c3.cooperator_id
                 LEFT JOIN tbl_cooperator_conf c4 ON c3.upper_agent_id = c4.cooperator_id
        WHERE c1.cooperator_id = #{cooperatorId}
    </select>
</mapper>